---
import { Icon } from "astro-icon/components";

import { event_map } from "@/contents/data";
import { getEventAsset } from "~/lib/assets";
import { sum } from "~/lib/math";
import { calculateEvents } from "../../_calculate";
import { getOptions } from "../../_options";

export const partial = true;

const event = event_map.get(Astro.params.event_id!);
if (!event) return new Response("NOT FOUND", { status: 404 });

const options = await getOptions(Astro);
const [{ data, ...stars }] = calculateEvents([event], options);
---

<main>
	<div class="badge not-dark:badge-soft badge-neutral">
		<Icon
			name="emojione:flag-for-japan"
			class="size-6 rounded-full border border-current"
		/>
		<div>
			<time datetime={event.startAt.jp.toISOString()}>
				{event.startAt.jp.format("DD-MM-YYYY")}
			</time>
			&ndash;
			<time datetime={event.endAt.jp.toISOString()}>
				{event.endAt.jp.format("DD-MM-YYYY")}
			</time>
		</div>
	</div>

	<div class="font-semibold max-sm:mt-1 sm:text-lg">{event.name}</div>
	<img
		{...await getEventAsset(Astro, { event, kind: "banner" })}
		class="rounded-box aspect-3/1 w-96"
	/>

	<div class="mt-2 inline-flex flex-wrap gap-1">
		{
			Object.entries(stars)
				.filter(([, value]) => value > 0)
				.map(([label, value]) => (
					<div class="badge badge-accent capitalize">
						{label} : {value}&starf;
					</div>
				))
		}

		<div class="badge badge-info">
			Total : {sum(Object.values(stars))}&starf;
		</div>
	</div>
</main>
