---
import type { Entry } from "@/contents/data";
import { formatNumber, sum } from "~/lib/math";
import { pluralize } from "~/lib/utilities";
import { calculateEvents } from "../_calculate";
import { STARS_PER_PULL } from "../_constants";

interface Props {
	events: (Entry<"event_map"> | null)[];
	options: App.CalculateOptions;
}

const { events, options } = Astro.props;

const results = calculateEvents(events, options);
const stars = {
	point: sum(results.map(({ point }) => point)),
	rank: sum(results.map(({ rank }) => rank)),
	story: sum(results.map(({ story }) => story)),
};

const total = sum(Object.values(stars));
const pulls = Math.floor(total / STARS_PER_PULL);
---

<>
	<div class="flex w-full items-center justify-center">
		<div class="flex flex-col gap-1">
			{
				Object.entries(stars).map(([label, value]) => (
					<div
						class:list={[
							"badge w-32 capitalize",
							value > 0 ? "badge-accent" : "badge-neutral",
						]}
					>
						{label} : {formatNumber(value)}&starf;
					</div>
				))
			}
		</div>

		<div class="flex flex-col gap-1">
			<div class="badge badge-info w-32">
				Total: {formatNumber(total)}&starf;
			</div>
			<div class="badge badge-info w-32">
				{pulls}&Cross; {pluralize(pulls, "Pull")}
			</div>
		</div>
	</div>
</>
